<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>HNFAK</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --brand: #ff3c00; --bg: #000000; --card: #0a0a0a; --glass: rgba(15, 15, 15, 0.85); --border: rgba(255,255,255,0.08); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; outline: none; }
        body { background: var(--bg); color: #fff; font-family: 'Plus Jakarta Sans', sans-serif; overflow: hidden; }

        /* AUTH & SCREENS */
        #auth-screen { position: fixed; inset: 0; background: #000; z-index: 60000; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .auth-card { background: var(--card); padding: 50px 30px; border-radius: 40px; width: 100%; max-width: 380px; text-align: center; border: 1px solid var(--border); }
        .btn-main { width: 100%; background: var(--brand); color: #fff; padding: 18px; border-radius: 18px; border: none; font-weight: 800; cursor: pointer; transition: 0.3s; }

        /* HEADER */
        header { position: fixed; top: 0; width: 100%; z-index: 8000; padding: calc(env(safe-area-inset-top) + 15px) 20px; background: rgba(0,0,0,0.7); backdrop-filter: blur(25px); border-bottom: 1px solid var(--border); }
        .nav-brand { font-size: 30px; font-weight: 900; letter-spacing: -2px; color: var(--brand); cursor: pointer; }
        
        /* NEW SECTIONS */
        .section-title { padding: 20px 20px 10px; font-size: 14px; font-weight: 800; color: var(--brand); letter-spacing: 1px; text-transform: uppercase; }
        .history-row { display: flex; overflow-x: auto; gap: 12px; padding: 0 20px 20px; scrollbar-width: none; }
        .history-card { flex: 0 0 140px; border-radius: 15px; overflow: hidden; position: relative; aspect-ratio: 16/9; background: #111; border: 1px solid var(--border); }
        .history-card img { width: 100%; height: 100%; object-fit: cover; opacity: 0.6; }

        /* GRID */
        #content-wrapper { height: 100vh; overflow-y: auto; padding-top: 230px; padding-bottom: 120px; }
        .grid { display: grid; gap: 18px; padding: 0 20px; grid-template-columns: repeat(2, 1fr); max-width: 1600px; margin: 0 auto; }
        @media(min-width: 768px) { .grid { grid-template-columns: repeat(4, 1fr); } }
        @media(min-width: 1200px) { .grid { grid-template-columns: repeat(6, 1fr); } }

        .card { border-radius: 24px; overflow: hidden; aspect-ratio: 2/3; position: relative; cursor: pointer; background: #0a0a0a; transition: 0.5s cubic-bezier(0.2, 1, 0.2, 1); border: 1px solid transparent; }
        .card:hover { transform: scale(1.05); border-color: var(--brand); }
        .card img { width: 100%; height: 100%; object-fit: cover; }

        /* PLAYER & MODALS */
        .modal { position: fixed; inset: 0; background: #000; z-index: 20000; display: none; flex-direction: column; overflow-y: auto; }
        .btn-action { background: #111; color: #fff; padding: 12px; border-radius: 15px; border: 1px solid var(--border); font-size: 13px; font-weight: 700; flex: 1; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-action.active { background: var(--brand); border-color: var(--brand); }

        /* SIDEBAR */
        #sidebar { position: fixed; left: -300px; top: 0; width: 300px; height: 100%; background: #050505; z-index: 50000; transition: 0.5s; padding: 80px 30px; }
        #sidebar.active { left: 0; }
        .side-link { padding: 16px; border-radius: 16px; cursor: pointer; color: #666; font-weight: 700; display: flex; align-items: center; gap: 15px; margin-bottom: 5px; }
        
        /* FOOTER NAV */
        .nav-bar { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 420px; background: rgba(15,15,15,0.8); backdrop-filter: blur(30px); border-radius: 28px; padding: 18px; display: flex; justify-content: space-around; z-index: 9000; border: 1px solid var(--border); }
        .nav-icon { color: #444; font-size: 24px; cursor: pointer; transition: 0.3s; }
        .nav-icon.active { color: var(--brand); }

        .hidden { display: none; }
        #failMsg { display: none; background: var(--brand); text-align: center; font-size: 10px; font-weight: 800; padding: 6px; }
        
        /* SURPRISE BUTTON */
        .magic-btn { position: fixed; right: 20px; bottom: 120px; width: 50px; height: 50px; background: var(--brand); border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 8500; box-shadow: 0 10px 20px rgba(255,60,0,0.4); animation: pulse 2s infinite; cursor: pointer; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-card">
            <h1 class="nav-brand" style="font-size: 50px; margin-bottom: 30px;">HNFAK</h1>
            <input type="text" id="eInp" style="width:100%; background:#111; border:1px solid var(--border); padding:18px; border-radius:18px; color:#fff; margin-bottom:12px;" placeholder="Kullanıcı Adı">
            <button class="btn-main" onclick="auth.go()">GİRİŞ YAP</button>
            <button class="btn-main" style="background:transparent; color:#444; margin-top:10px;" onclick="auth.guest()">Misafir Girişi</button>
        </div>
    </div>

    <div id="sidebar">
        <h2 style="color:var(--brand); margin-bottom:30px; font-weight:900;">KEŞFET</h2>
        <div class="side-link" onclick="app.fG('top_rated')"><i class="fas fa-star"></i> En İyiler (IMDb)</div>
        <div class="side-link" onclick="app.fT('movie')"><i class="fas fa-film"></i> Filmler</div>
        <div class="side-link" onclick="app.fT('tv')"><i class="fas fa-tv"></i> Diziler</div>
        <div class="side-link" onclick="app.fG(16)"><i class="fas fa-child"></i> Animasyon</div>
        <div class="side-link" onclick="app.fG(27)"><i class="fas fa-ghost"></i> Korku</div>
        <div class="side-link" onclick="auth.off()" style="margin-top:40px; color:var(--brand)"><i class="fas fa-power-off"></i> Çıkış</div>
    </div>

    <header>
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <i class="fas fa-bars-staggered fa-lg" onclick="app.menu()"></i>
            <span class="nav-brand" onclick="app.reset()">HNFAK</span>
            <i class="fas fa-user-circle fa-xl" onclick="app.openProfile()" style="color:var(--brand); cursor:pointer;"></i>
        </div>
        <div style="background: rgba(255,255,255,0.05); border-radius: 20px; padding: 12px 20px; display: flex; align-items: center; margin-top: 15px; border: 1px solid var(--border);">
            <i class="fas fa-search" style="opacity:0.3;"></i>
            <input type="text" style="background:transparent; border:none; color:#fff; width:100%; margin-left:12px;" placeholder="Ara..." oninput="app.search(this.value)">
        </div>
    </header>

    <div class="magic-btn" onclick="app.surprise()" title="Rastgele Film Getir"><i class="fas fa-magic"></i></div>

    <div id="content-wrapper">
        <div id="history-sec" class="hidden">
            <div class="section-title">İzlemeye Devam Et</div>
            <div id="history-list" class="history-row"></div>
        </div>
        <div class="section-title">Sizin İçin Seçilenler</div>
        <div id="grid" class="grid"></div>
    </div>

    <div id="pModal" class="modal">
        <div style="position:sticky; top:0; z-index:100; background:#000;">
            <i class="fas fa-chevron-down" onclick="app.close()" style="position:absolute; top:20px; left:20px; z-index:10; background:rgba(0,0,0,0.6); padding:12px; border-radius:50%; cursor:pointer;"></i>
            <iframe id="vFrame" src="" style="width:100%; aspect-ratio:16/9; border:none;" allowfullscreen></iframe>
            <div id="failMsg">BAĞLANTI SORUNU: YEDEK SUNUCU AKTİF...</div>
        </div>
        <div class="modal-body">
            <h1 id="mT" style="font-size:28px; font-weight:900; margin-bottom:10px;"></h1>
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <button id="mFav" class="btn-action"><i class="fas fa-heart"></i> Favori</button>
                <button id="mTrailer" class="btn-action" style="background:#cc0000; border-color:#cc0000;"><i class="fab fa-youtube"></i> Fragman</button>
            </div>
            <div style="display:flex; gap:10px; margin-bottom:25px;">
                <button class="btn-main" style="flex:1;" onclick="app.src(1)">SERVER 1</button>
                <button class="btn-main" style="flex:1; background:#111; border:1px solid #222;" onclick="app.src(2)">SERVER 2</button>
            </div>
            <div id="tvPanel" class="hidden" style="display:flex; gap:10px; margin-bottom:25px;">
                <select id="selS" onchange="app.epC()" style="flex:1; padding:16px; background:#111; color:#fff; border:1px solid var(--border); border-radius:18px;"></select>
                <select id="selE" onchange="app.epC()" style="flex:1; padding:16px; background:#111; color:#fff; border:1px solid var(--border); border-radius:18px;"></select>
            </div>
            <p id="mD" style="opacity:0.5; line-height:1.8; margin-bottom:30px;"></p>
            <div id="castList" style="display:flex; overflow-x:auto; gap:15px; scrollbar-width:none; padding-bottom:10px;"></div>
            <div id="disqus_thread" style="margin-top:40px;"></div>
        </div>
    </div>

    <nav class="nav-bar">
        <div class="nav-icon active" onclick="app.reset()"><i class="fas fa-house"></i></div>
        <div class="nav-icon" onclick="app.fT('movie')"><i class="fas fa-play"></i></div>
        <div class="nav-icon" onclick="app.fT('tv')"><i class="fas fa-tv"></i></div>
        <div class="nav-icon" onclick="app.openProfile()"><i class="fas fa-user"></i></div>
    </nav>

    <script>
        const K = 'c4c468367090c8c779814353144fe7f7', IMG = 'https://image.tmdb.org/t/p/w500';
        let page = 1, mode = 'trend', loading = false, cur = {id:'', t:'', s:1, e:1};
        let favs = JSON.parse(localStorage.getItem('hnfak_favs')) || [];
        let hist = JSON.parse(localStorage.getItem('hnfak_hist')) || [];
        let user = JSON.parse(localStorage.getItem('hnfak_user')) || null;

        const auth = {
            go() {
                const u = document.getElementById('eInp').value; if(!u) return;
                user = { name: u }; localStorage.setItem('hnfak_user', JSON.stringify(user));
                this.done();
            },
            guest() { user = { name: 'Misafir' }; this.done(); },
            done() { document.getElementById('auth-screen').style.display='none'; app.start(); },
            off() { localStorage.removeItem('hnfak_user'); location.reload(); }
        };

        const app = {
            start() { if(!user) return; this.fT('trend'); this.loadHist(); },
            menu() { const s = document.getElementById('sidebar'); s.classList.toggle('active'); },
            async fT(type, more = false) {
                if(!more) { page = 1; document.getElementById('grid').innerHTML = ''; mode = type; }
                const r = await fetch(`https://api.themoviedb.org/3/${type==='trend'?'trending/all/day':'discover/'+type}?api_key=${K}&language=tr-TR&page=${page}`);
                const d = await r.json(); this.render(d.results, 'grid');
            },
            async fG(id) {
                document.getElementById('grid').innerHTML='';
                let url = `https://api.themoviedb.org/3/discover/movie?api_key=${K}&language=tr-TR`;
                if(id === 'top_rated') url = `https://api.themoviedb.org/3/movie/top_rated?api_key=${K}&language=tr-TR`;
                else url += `&with_genres=${id}`;
                const r = await fetch(url); const d = await r.json(); this.render(d.results, 'grid');
            },
            render(list, target) {
                const container = document.getElementById(target);
                list.filter(x => x.poster_path).forEach(x => {
                    const isFav = favs.some(f => f.id == x.id);
                    const d = document.createElement('div'); d.className = 'card';
                    d.innerHTML = `<img src="${IMG}${x.poster_path}" onclick="app.open('${x.id}','${x.title?'movie':'tv'}')">`;
                    container.appendChild(d);
                });
            },
            async open(id, type) {
                cur = {id, t:type, s:1, e:1};
                const [mR, cR, vR] = await Promise.all([
                    fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${K}&language=tr-TR`),
                    fetch(`https://api.themoviedb.org/3/${type}/${id}/credits?api_key=${K}&language=tr-TR`),
                    fetch(`https://api.themoviedb.org/3/${type}/${id}/videos?api_key=${K}`)
                ]);
                const d = await mR.json(), c = await cR.json(), v = await vR.json();
                
                document.getElementById('mT').innerText = d.title || d.name;
                document.getElementById('mD').innerText = d.overview;
                document.getElementById('mFav').onclick = () => this.toggleFav({id, p:d.poster_path, t:type});
                document.getElementById('mFav').classList.toggle('active', favs.some(f=>f.id==id));
                
                const trailer = v.results.find(x => x.type === 'Trailer');
                document.getElementById('mTrailer').onclick = () => { if(trailer) window.open(`https://youtube.com/watch?v=${trailer.key}`); };

                document.getElementById('castList').innerHTML = c.cast.slice(0,10).map(x => `<div style="text-align:center; flex:0 0 80px;"><img src="${x.profile_path?IMG+x.profile_path:'https://via.placeholder.com/80'}" style="width:70px; height:70px; border-radius:50%; object-fit:cover;"><p style="font-size:9px; margin-top:5px;">${x.name}</p></div>`).join('');
                
                if(type === 'tv') {
                    document.getElementById('tvPanel').classList.remove('hidden');
                    document.getElementById('selS').innerHTML = d.seasons.map(s => `<option value="${s.season_number}">${s.name}</option>`).join('');
                    this.lE(d.seasons[0].episode_count);
                } else document.getElementById('tvPanel').classList.add('hidden');

                this.src(1);
                this.saveHist(id, d.backdrop_path || d.poster_path, type);
                document.getElementById('pModal').style.display='flex';
            },
            saveHist(id, img, type) {
                hist = hist.filter(x => x.id !== id);
                hist.unshift({id, img, type});
                if(hist.length > 10) hist.pop();
                localStorage.setItem('hnfak_hist', JSON.stringify(hist));
                this.loadHist();
            },
            loadHist() {
                const sec = document.getElementById('history-sec');
                const list = document.getElementById('history-list');
                if(hist.length > 0) {
                    sec.classList.remove('hidden');
                    list.innerHTML = hist.map(x => `<div class="history-card" onclick="app.open('${x.id}','${x.type}')"><img src="${IMG}${x.img}"><div style="position:absolute; bottom:5px; left:5px; font-size:10px; font-weight:800; color:var(--brand);">İZLENİYOR</div></div>`).join('');
                }
            },
            async surprise() {
                const r = await fetch(`https://api.themoviedb.org/3/movie/popular?api_key=${K}&page=${Math.floor(Math.random()*10)+1}`);
                const d = await r.json(); const item = d.results[Math.floor(Math.random()*d.results.length)];
                this.open(item.id, 'movie');
            },
            toggleFav(obj) {
                const idx = favs.findIndex(f => f.id == obj.id);
                if(idx > -1) favs.splice(idx, 1); else favs.push(obj);
                localStorage.setItem('hnfak_favs', JSON.stringify(favs));
                document.getElementById('mFav').classList.toggle('active');
            },
            src(s) {
                const h = {1:'https://vidsrc.xyz/embed/', 2:'https://vidsrc.me/embed/'};
                let url = `${h[s]}${cur.t}/${cur.id}`;
                if(cur.t === 'tv') url += `/${cur.s}/${cur.e}`;
                document.getElementById('vFrame').src = url;
            },
            lE(c) { let h = ""; for(let i=1; i<=c; i++) h += `<option value="${i}">${i}. Bölüm</option>`; document.getElementById('selE').innerHTML = h; },
            epC() { cur.s = document.getElementById('selS').value; cur.e = document.getElementById('selE').value; this.src(1); },
            close() { document.getElementById('pModal').style.display='none'; document.getElementById('vFrame').src=''; },
            reset() { page=1; this.fT('trend'); },
            search(q) {
                if(!q) return this.reset();
                setTimeout(async () => {
                    const r = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${K}&language=tr-TR&query=${q}`);
                    const d = await r.json(); document.getElementById('grid').innerHTML = ''; this.render(d.results, 'grid');
                }, 500);
            }
        };
        if(user) auth.done();
    </script>
</body>
</html>
