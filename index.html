<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HNFAK | V26 Elite Media</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        :root { --brand: #ff3c00; --bg: #0a0a0a; --panel: #111; --border: #222; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; overflow-x: hidden; }
        ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }

        /* HEADER */
        header { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 10px 4%; background: rgba(0,0,0,0.95); border-bottom: 1px solid var(--border);
            position: fixed; width: 100%; top: 0; z-index: 1000; box-sizing: border-box;
        }
        .header-left { display: flex; align-items: center; gap: 15px; }
        .search-box { background: #1a1a1a; padding: 8px 15px; border-radius: 50px; border: 1px solid #333; display: flex; align-items: center; width: 250px; }
        .search-box input { background: transparent; border: none; color: white; outline: none; width: 100%; margin-left: 10px; font-size: 14px; }

        /* SIDEBAR */
        .sidebar { position: fixed; left: -280px; top: 0; width: 280px; height: 100%; background: #0f0f0f; z-index: 2000; transition: 0.4s; padding: 20px; box-sizing: border-box; border-right: 1px solid var(--border); overflow-y: auto; }
        .sidebar.active { left: 0; }
        .sidebar-link { display: flex; align-items: center; gap: 10px; padding: 12px 0; color: #bbb; cursor: pointer; border-bottom: 1px solid #1a1a1a; font-size: 14px; }
        .sidebar-link:hover { color: var(--brand); padding-left: 8px; }
        .cat-title { color: var(--brand); font-size: 11px; font-weight: bold; margin: 20px 0 10px; text-transform: uppercase; letter-spacing: 1px; }

        /* SLIDER */
        .hero { margin-top: 70px; padding: 0 4%; position: relative; height: 350px; overflow: hidden; border-radius: 15px; }
        .hero-slide { position: absolute; inset: 0; display: none; background-size: cover; background-position: center; transition: 0.5s; }
        .hero-slide.active { display: flex; align-items: flex-end; }
        .hero-content { background: linear-gradient(transparent, rgba(0,0,0,0.9)); width: 100%; padding: 40px; }
        .hero-title { font-size: 32px; font-weight: 900; margin: 0; }

        /* GRID */
        .container { padding: 30px 4% 50px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .card { background: #111; border-radius: 12px; overflow: hidden; cursor: pointer; border: 1px solid var(--border); transition: 0.3s; aspect-ratio: 2/3; position: relative; }
        .card:hover { transform: translateY(-5px); border-color: var(--brand); box-shadow: 0 5px 15px rgba(255, 60, 0, 0.2); }
        .card img { width: 100%; height: 100%; object-fit: cover; }
        .rating { position: absolute; top: 8px; left: 8px; background: rgba(0,0,0,0.8); color: #f1c40f; padding: 3px 6px; border-radius: 5px; font-size: 10px; font-weight: bold; z-index: 5; }
        .fav-btn { position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.6); color: #fff; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 10; transition: 0.3s; }
        .fav-btn.active { color: var(--brand); }

        /* MODALS */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.98); display: none; align-items: center; justify-content: center; z-index: 3000; }
        .modal-content { background: var(--panel); width: 95%; max-width: 1000px; height: 90vh; border-radius: 15px; border: 1px solid #333; overflow-y: auto; position: relative; }
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 35px; color: white; cursor: pointer; z-index: 100; }
        
        .auth-content { max-width: 380px; padding: 40px; text-align: center; height: auto; }
        .auth-input { width: 100%; padding: 12px; margin: 10px 0; background: #1a1a1a; border: 1px solid #333; color: white; border-radius: 8px; box-sizing: border-box; }
        .auth-btn { width: 100%; padding: 14px; background: var(--brand); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 5px; }

        @media (max-width: 768px) { .hero { height: 200px; } .search-box { width: 140px; } }
    </style>
</head>
<body>

    <header>
        <div class="header-left">
            <i class="fas fa-bars" onclick="app.menu()" style="cursor:pointer; font-size: 20px;"></i>
            <div onclick="location.reload()" style="font-weight:900; font-size: 22px; cursor:pointer;">HNFAK <span style="color:var(--brand)">Media</span></div>
        </div>
        <div class="search-box">
            <i class="fas fa-search" style="color:#666"></i>
            <input type="text" id="sInp" placeholder="Ara..." onkeyup="event.key==='Enter' && app.search()">
        </div>
        <button id="uBtn" onclick="app.authPanel()" style="background:var(--brand); border:none; color:white; padding:8px 18px; border-radius:50px; cursor:pointer; font-weight:bold;">Giriş</button>
    </header>

    <div class="sidebar" id="side">
        <h2 style="color:var(--brand)">HNFAK ELITE</h2>
        <div class="sidebar-link" onclick="app.reset('trend'); app.menu()"><i class="fas fa-home"></i> Ana Sayfa</div>
        <div class="sidebar-link" onclick="app.showFavs(); app.menu()"><i class="fas fa-heart"></i> Favorilerim</div>
        
        <div class="cat-title">KATEGORİLER</div>
        <div id="catList"></div>
    </div>

    <div class="hero" id="hero"></div>

    <div class="container">
        <div id="recentArea" style="display:none;">
            <h3 style="color:#888;">Son İzlediklerin</h3>
            <main id="recentGrid" class="grid"></main>
        </div>
        
        <h2 id="title" style="color:var(--brand); margin-bottom:20px;">Popüler Trendler</h2>
        <main id="grid" class="grid"></main>
    </div>

    <div id="pModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="app.close()">&times;</span>
            <div style="width:100%; aspect-ratio:16/9; background:#000;"><iframe id="vFrame" src="" style="width:100%; height:100%; border:none;" allowfullscreen></iframe></div>
            <div style="padding:25px;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h2 id="mT" style="margin:0;"></h2>
                    <i id="mFav" class="fas fa-heart" style="font-size:24px; cursor:pointer;"></i>
                </div>
                <div id="tvPanel" style="display:none; margin:15px 0; background:#1a1a1a; padding:15px; border-radius:8px; border:1px solid #333;">
                    Sezon: <select id="selS" onchange="app.epChange()"></select>
                    Bölüm: <select id="selE" onchange="app.epChange()"></select>
                </div>
                <div style="margin:15px 0; display:flex; gap:10px;">
                    <button onclick="app.src(1)" class="auth-btn" style="width:auto; padding:10px 20px;">Sunucu 1</button>
                    <button onclick="app.src(2)" class="auth-btn" style="width:auto; padding:10px 20px; background:#333;">Sunucu 2</button>
                </div>
                <p id="mD" style="color:#aaa; font-size:14px; line-height:1.6;"></p>
                <div id="mC" style="display:flex; gap:10px; overflow-x:auto; padding-bottom:10px;"></div>
                <hr style="border-color:#222;">
                <h3 style="color:var(--brand)">Yorumlar</h3>
                <textarea id="cInp" class="auth-input" style="height:80px; resize:none;" placeholder="Yorumun..."></textarea>
                <button onclick="app.postComment()" class="auth-btn" style="width:auto; padding:8px 30px;">Gönder</button>
                <div id="cList" style="margin-top:20px;"></div>
            </div>
        </div>
    </div>

    <div id="authModal" class="modal">
        <div class="modal-content auth-content">
            <span class="close-btn" onclick="app.closeAuth()">&times;</span>
            <div id="authStep1">
                <h2 style="color:var(--brand)">HNFAK Media</h2>
                <input type="text" id="uName" class="auth-input" placeholder="İsim">
                <input type="email" id="uMail" class="auth-input" placeholder="E-posta">
                <button onclick="app.sendVerifyCode()" id="sendBtn" class="auth-btn">KOD GÖNDER</button>
                <button onclick="app.guestLogin()" style="background:transparent; color:#666; border:none; cursor:pointer; margin-top:15px;">Misafir Olarak Gir</button>
            </div>
            <div id="authStep2" style="display:none;">
                <h2 style="color:var(--brand)">Onayla</h2>
                <input type="text" id="vCodeInp" class="auth-input" placeholder="4 Haneli Kod">
                <button onclick="app.verifyAndLogin()" class="auth-btn">GİRİŞ YAP</button>
            </div>
        </div>
    </div>

    <script>
        const SERVICE_ID = "service_5dtv2rj", TEMPLATE_ID = "template_mkb1ucg", PUBLIC_KEY = "xzqFieS_v8a0G8B5B";
        const TMDB_KEY = 'c4c468367090c8c779814353144fe7f7', IMG = 'https://image.tmdb.org/t/p/w500', BG = 'https://image.tmdb.org/t/p/original';

        emailjs.init(PUBLIC_KEY);
        let page = 1, mode = 'trend', currentCatId = null, generatedCode = "", favorites = JSON.parse(localStorage.getItem('hn_favs')) || [], recent = JSON.parse(localStorage.getItem('hn_recent')) || [];
        let cur = {id:'', type:'', s:1, e:1};

        const app = {
            start() {
                this.fetchTrend(); this.renderCats(); this.loadHero(); this.renderRecent();
                window.onscroll = () => { if((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 800) this.loadMore(); };
                const saved = localStorage.getItem('hn_u'); if(saved) document.getElementById('uBtn').innerText = saved;
            },
            menu() { document.getElementById('side').classList.toggle('active'); },
            reset(m) { page=1; mode=m; document.getElementById('grid').innerHTML=''; document.getElementById('hero').style.display='block'; this.fetchTrend(); },

            async loadHero() {
                const r = await fetch(`https://api.themoviedb.org/3/movie/popular?api_key=${TMDB_KEY}&language=tr-TR`);
                const d = await r.json();
                document.getElementById('hero').innerHTML = d.results.slice(0,5).map((m,i) => `
                    <div class="hero-slide ${i===0?'active':''}" style="background-image:url(${BG}${m.backdrop_path})">
                        <div class="hero-content">
                            <h1 class="hero-title">${m.title}</h1>
                            <button onclick="app.open('${m.id}','movie')" class="auth-btn" style="width:auto; margin-top:15px; padding:10px 30px;">Hemen İzle</button>
                        </div>
                    </div>`).join('');
                setInterval(() => {
                    let slides = document.querySelectorAll('.hero-slide');
                    let active = document.querySelector('.hero-slide.active');
                    let next = active.nextElementSibling || slides[0];
                    active.classList.remove('active'); next.classList.add('active');
                }, 5000);
            },

            renderCats() {
                const cats = {28:'Aksiyon', 12:'Macera', 16:'Animasyon', 35:'Komedi', 80:'Suç', 99:'Belgesel', 18:'Dram', 10751:'Aile', 14:'Fantastik', 27:'Korku', 9648:'Gizem', 878:'Bilim Kurgu', 53:'Gerilim', 37:'Western'};
                document.getElementById('catList').innerHTML = Object.entries(cats).map(([id, name]) => `<div class="sidebar-link" onclick="app.fetchCat(${id}, '${name}'); app.menu()">${name}</div>`).join('');
            },

            async fetchTrend() {
                const r = await fetch(`https://api.themoviedb.org/3/trending/all/week?api_key=${TMDB_KEY}&language=tr-TR&page=${page}`);
                const d = await r.json(); this.render(d.results, "Popüler Trendler");
            },

            async fetchCat(id, name) {
                mode = 'cat'; currentCatId = id; page = 1; document.getElementById('grid').innerHTML = '';
                document.getElementById('hero').style.display = 'none';
                const r = await fetch(`https://api.themoviedb.org/3/discover/movie?api_key=${TMDB_KEY}&with_genres=${id}&language=tr-TR&page=${page}`);
                const d = await r.json(); this.render(d.results, name);
            },

            async search() {
                const q = document.getElementById('sInp').value; if(!q) return;
                mode = 'search'; document.getElementById('grid').innerHTML = ''; document.getElementById('hero').style.display = 'none';
                const r = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${TMDB_KEY}&query=${q}&language=tr-TR`);
                const d = await r.json(); this.render(d.results, `"${q}" İçin Sonuçlar`);
            },

            render(list, t) {
                document.getElementById('title').innerText = t;
                list.filter(m => m.poster_path).forEach(m => {
                    const isFav = favorites.find(f => f.id == m.id);
                    const d = document.createElement('div');
                    d.className = 'card';
                    d.innerHTML = `
                        <div class="rating"><i class="fas fa-star"></i> ${m.vote_average.toFixed(1)}</div>
                        <div class="fav-btn ${isFav?'active':''}" onclick="app.toggleFav(event, ${JSON.stringify(m).replace(/"/g, '&quot;')})"><i class="fas fa-heart"></i></div>
                        <img src="${IMG}${m.poster_path}" onclick="app.open('${m.id}','${m.title?'movie':'tv'}')">
                    `;
                    document.getElementById('grid').appendChild(d);
                });
            },

            async open(id, type) {
                cur = {id, type, s:1, e:1};
                const r = await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${TMDB_KEY}&language=tr-TR&append_to_response=credits`);
                const d = await r.json();
                document.getElementById('mT').innerText = d.title || d.name;
                document.getElementById('mD').innerText = d.overview;
                document.getElementById('mFav').className = favorites.find(f => f.id == id) ? 'fas fa-heart active' : 'fas fa-heart';
                document.getElementById('mFav').onclick = (e) => this.toggleFav(e, d);
                
                if(type === 'tv') {
                    document.getElementById('tvPanel').style.display = 'block';
                    document.getElementById('selS').innerHTML = d.seasons.map(s => `<option value="${s.season_number}">${s.name}</option>`).join('');
                    this.loadEps(d.seasons[0].episode_count);
                } else document.getElementById('tvPanel').style.display = 'none';
                
                this.addToRecent(d); this.src(1); this.loadComments(id);
                document.getElementById('mC').innerHTML = d.credits.cast.slice(0,8).map(c=>`<div style="text-align:center; min-width:70px;"><img src="${c.profile_path?IMG+c.profile_path:'https://via.placeholder.com/60'}" style="width:50px;height:50px;border-radius:50%;object-fit:cover"><p style="font-size:10px; margin:5px 0 0 0;">${c.name}</p></div>`).join('');
                document.getElementById('pModal').style.display='flex'; document.body.style.overflow='hidden';
            },

            toggleFav(e, m) {
                e.stopPropagation();
                const idx = favorites.findIndex(f => f.id == m.id);
                if(idx > -1) favorites.splice(idx, 1);
                else favorites.unshift({id: m.id, title: m.title || m.name, poster_path: m.poster_path, vote_average: m.vote_average});
                localStorage.setItem('hn_favs', JSON.stringify(favorites));
                if(e.target.classList) e.target.closest('.fav-btn, #mFav').classList.toggle('active');
            },

            showFavs() {
                mode = 'fav'; document.getElementById('grid').innerHTML = ''; document.getElementById('hero').style.display = 'none';
                this.render(favorites, "Favorilerim");
            },

            addToRecent(m) {
                recent = recent.filter(r => r.id != m.id);
                recent.unshift({id: m.id, title: m.title || m.name, poster_path: m.poster_path, vote_average: m.vote_average, type: m.title?'movie':'tv'});
                recent = recent.slice(0, 10); localStorage.setItem('hn_recent', JSON.stringify(recent)); this.renderRecent();
            },

            renderRecent() {
                if(recent.length === 0) return;
                document.getElementById('recentArea').style.display = 'block';
                document.getElementById('recentGrid').innerHTML = recent.map(m => `
                    <div class="card" onclick="app.open('${m.id}','${m.type}')">
                        <img src="${IMG}${m.poster_path}">
                    </div>
                `).join('');
            },

            loadEps(c) { let h = ""; for(let i=1; i<=c; i++) h += `<option value="${i}">${i}. Bölüm</option>`; document.getElementById('selE').innerHTML = h; },
            epChange() { cur.s = document.getElementById('selS').value; cur.e = document.getElementById('selE').value; this.src(1); },
            src(s) { const b = s === 1 ? 'https://vidsrc.me/embed/' : 'https://vidsrc.xyz/embed/'; document.getElementById('vFrame').src = `${b}${cur.type}?tmdb=${cur.id}${cur.type==='tv'?'&season='+cur.s+'&episode='+cur.e:''}`; },
            
            authPanel() { document.getElementById('authModal').style.display = 'flex'; },
            async sendVerifyCode() {
                const m = document.getElementById('uMail').value.trim(), n = document.getElementById('uName').value.trim();
                if(!m || !n) return alert("Bilgileri girin!");
                generatedCode = Math.floor(1000 + Math.random() * 9000).toString();
                document.getElementById('sendBtn').innerText = "Gönderiliyor...";
                emailjs.send(SERVICE_ID, TEMPLATE_ID, { to_name: n, email: m, passcode: generatedCode, company_name: "HNFAK Media" })
                .then(() => {
                    document.getElementById('authStep1').style.display='none'; document.getElementById('authStep2').style.display='block';
                }).catch(() => { alert("E-posta hatası!"); document.getElementById('sendBtn').innerText = "KOD GÖNDER"; });
            },
            verifyAndLogin() {
                if(document.getElementById('vCodeInp').value === generatedCode) {
                    localStorage.setItem('hn_u', document.getElementById('uName').value);
                    document.getElementById('uBtn').innerText = document.getElementById('uName').value;
                    this.closeAuth();
                } else alert("Kod yanlış!");
            },
            guestLogin() { localStorage.setItem('hn_u', 'Misafir'); document.getElementById('uBtn').innerText = 'Misafir'; this.closeAuth(); },
            loadComments(id) {
                const cms = JSON.parse(localStorage.getItem('c_'+id)) || [];
                document.getElementById('cList').innerHTML = cms.map(c => `<div style="margin-bottom:12px; border-left:2px solid var(--brand); padding-left:10px;"><small style="color:var(--brand)">${c.u}</small><p style="margin:2px 0; font-size:13px;">${c.t}</p></div>`).join('') || "Henüz yorum yok.";
            },
            postComment() {
                const u = localStorage.getItem('hn_u') || "Misafir", t = document.getElementById('cInp').value; if(!t) return;
                const cms = JSON.parse(localStorage.getItem('c_'+cur.id)) || [];
                cms.unshift({u, t}); localStorage.setItem('c_'+cur.id, JSON.stringify(cms));
                document.getElementById('cInp').value = ""; this.loadComments(cur.id);
            },
            closeAuth() { document.getElementById('authModal').style.display='none'; },
            close() { document.getElementById('pModal').style.display='none'; document.getElementById('vFrame').src=''; document.body.style.overflow='auto'; },
            loadMore() { if(mode==='trend'||mode==='cat') { page++; mode==='trend'?this.fetchTrend():this.fetchCat(currentCatId, document.getElementById('title').innerText); } }
        };
        window.onload = () => app.start();
    </script>
</body>
</html>
