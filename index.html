<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HNFAK | V33 NEXUS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        :root { --brand: #ff3c00; --bg: #000; --panel: rgba(10,10,10,0.85); --border: rgba(255,60,0,0.15); --text: #fff; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', system-ui, sans-serif; margin: 0; padding-bottom: 90px; overflow-x: hidden; }

        /* AMBIENT BACKGROUND */
        #ambient-glow { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(circle at 50% 50%, rgba(255,60,0,0.05), transparent); transition: 1s; }

        /* HEADER & GLASSMORPHISM */
        header { position: fixed; top: 0; width: 100%; z-index: 2000; padding: 15px 5%; background: rgba(0,0,0,0.7); backdrop-filter: blur(25px); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 26px; font-weight: 950; letter-spacing: -1px; cursor: pointer; }
        .logo span { color: var(--brand); text-shadow: 0 0 15px var(--brand); }

        /* AI SEARCH BAR */
        .ai-search { display: flex; align-items: center; background: #111; border-radius: 50px; padding: 8px 15px; border: 1px solid var(--border); width: 40%; transition: 0.3s; }
        .ai-search:focus-within { border-color: var(--brand); box-shadow: 0 0 15px rgba(255,60,0,0.2); }
        .ai-search input { background: none; border: none; color: #fff; width: 100%; padding: 5px; font-size: 14px; }

        /* DYNAMIC FILTERS */
        .filter-row { display: flex; gap: 10px; overflow-x: auto; padding: 100px 5% 10px; scrollbar-width: none; }
        .filter-chip { padding: 10px 20px; background: var(--panel); border: 1px solid #222; border-radius: 12px; font-size: 13px; white-space: nowrap; cursor: pointer; transition: 0.3s; }
        .filter-chip.active { background: var(--brand); border-color: var(--brand); }

        /* GRID SYSTEM */
        .container { padding: 20px 5%; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 15px; }
        @media(min-width: 768px) { .grid { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 25px; } }

        .card { background: var(--panel); border-radius: 16px; overflow: hidden; border: 1px solid #111; aspect-ratio: 2/3; position: relative; cursor: pointer; transition: 0.5s cubic-bezier(0.19, 1, 0.22, 1); }
        .card:hover { transform: translateY(-10px) rotate(1deg); border-color: var(--brand); box-shadow: 0 20px 40px rgba(0,0,0,0.8); }
        .card img { width: 100%; height: 100%; object-fit: cover; }
        .card-info { position: absolute; bottom: 0; width: 100%; padding: 10px; background: linear-gradient(0deg, #000 0%, transparent 100%); font-size: 12px; font-weight: bold; }

        /* PLAYER MODAL V33 */
        .modal { position: fixed; inset: 0; background: #000; z-index: 5000; display: none; flex-direction: column; overflow-y: auto; }
        .player-wrapper { width: 100%; aspect-ratio: 16/9; position: sticky; top: 0; background: #000; box-shadow: 0 10px 50px #000; }
        .ambient-layer { position: absolute; inset: 0; z-index: -1; filter: blur(100px); opacity: 0.4; }

        /* NAVIGATION */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(20px); display: flex; justify-content: space-around; padding: 15px 10px; border-top: 1px solid var(--border); z-index: 4000; }
        .nav-item { color: #666; font-size: 22px; cursor: pointer; position: relative; }
        .nav-item.active { color: var(--brand); }
        .nav-item span { display: block; font-size: 10px; margin-top: 5px; font-weight: 800; }

        /* BUTTONS */
        .btn-v33 { background: var(--brand); color: #fff; padding: 12px 24px; border-radius: 15px; border: none; font-weight: 900; cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 10px; }
        .btn-v33:hover { transform: scale(1.05); filter: brightness(1.2); }

        /* UTILS */
        .hidden { display: none; }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <div id="ambient-glow"></div>

    <header>
        <div class="logo" onclick="app.egg()">HNF<span>AK</span></div>
        <div class="ai-search">
            <i class="fas fa-magic" style="color:var(--brand); margin-right: 10px;"></i>
            <input type="text" id="aiInp" placeholder="AI ile her ÅŸeyi sor..." onkeydown="if(event.key==='Enter') app.searchAI()">
        </div>
        <div style="font-size: 20px;"><i class="fas fa-user-circle" onclick="app.authPanel()"></i></div>
    </header>

    <div class="filter-row">
        <div class="filter-chip active" onclick="app.reset('trend')">ðŸ”¥ Trendler</div>
        <div class="filter-chip" onclick="app.fetchCat(28, 'Aksiyon')">Aksiyon</div>
        <div class="filter-chip" onclick="app.fetchCat(878, 'Bilim Kurgu')">Bilim Kurgu</div>
        <div class="filter-chip" onclick="app.fetchCat(27, 'Korku')">Korku</div>
        <div class="filter-chip" onclick="app.fetchCat(35, 'Komedi')">Komedi</div>
        <div class="filter-chip" onclick="app.fetchCat(16, 'Animasyon')">Animasyon</div>
    </div>

    <div class="container">
        <h2 id="section-title" style="letter-spacing: -1px; margin-bottom: 25px;">Senin Ä°Ã§in SeÃ§ilenler</h2>
        <main id="grid" class="grid"></main>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="app.reset('trend')"><i class="fas fa-compass"></i><span>KeÅŸfet</span></div>
        <div class="nav-item" onclick="app.showFavs()"><i class="fas fa-heart"></i><span>Listem</span></div>
        <div class="nav-item" onclick="app.showActivity()"><i class="fas fa-bolt"></i><span>CanlÄ±</span></div>
        <div class="nav-item" onclick="app.authPanel()"><i class="fas fa-crown"></i><span>Nexus</span></div>
    </div>

    <div id="pModal" class="modal">
        <div id="pAmbient" class="ambient-layer"></div>
        <div class="player-wrapper">
            <i class="fas fa-times" onclick="app.close()" style="position:absolute; top:20px; right:20px; z-index:100; font-size:24px; cursor:pointer;"></i>
            <iframe id="vFrame" src="" style="width:100%; height:100%; border:none;" allowfullscreen></iframe>
        </div>
        <div style="padding: 30px; max-width: 1000px; margin: 0 auto;">
            <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                <div>
                    <h1 id="mT" style="margin:0; font-size: 32px; letter-spacing: -1px;"></h1>
                    <p id="mRate" style="color:var(--brand); font-weight:bold; margin-top:5px;"></p>
                </div>
                <div style="text-align:right;">
                    <span class="status-dot"></span> <small style="opacity:0.5;">4K AkÄ±ÅŸ Aktif</small>
                </div>
            </div>

            <div id="tvPanel" class="hidden" style="margin: 25px 0; background: #080808; padding: 20px; border-radius: 20px; border: 1px solid #111;">
                <div style="display:flex; gap:15px;">
                    <select id="selS" onchange="app.epChange()" style="flex:1; background:#000; color:#fff; padding:12px; border:1px solid #222; border-radius:12px;"></select>
                    <select id="selE" onchange="app.epChange()" style="flex:1; background:#000; color:#fff; padding:12px; border:1px solid #222; border-radius:12px;"></select>
                </div>
            </div>

            <div style="display:flex; gap:15px; margin: 30px 0;">
                <button onclick="app.src(1)" class="btn-v33">SUNUCU 1</button>
                <button onclick="app.src(2)" class="btn-v33" style="background:#111;">SUNUCU 2</button>
                <button id="favBtn" class="btn-v33" style="background:transparent; border:1px solid #222;"><i class="fas fa-plus"></i></button>
                <button onclick="app.share()" class="btn-v33" style="background:transparent; border:1px solid #222;"><i class="fas fa-share-nodes"></i></button>
            </div>

            <p id="mD" style="line-height:1.8; opacity:0.7; font-size:16px;"></p>
            
            <hr style="border:0; border-top:1px solid #111; margin:40px 0;">
            
            <h3>Nexus Topluluk</h3>
            <div style="display:flex; gap:15px;">
                <input type="text" id="cInp" placeholder="Bu yapÄ±m hakkÄ±nda ne dÃ¼ÅŸÃ¼nÃ¼yorsun?" style="flex:1; background:#080808; border:1px solid #111; color:#fff; padding:18px; border-radius:15px;">
                <button onclick="app.postComment()" class="btn-v33">PAYLAÅž</button>
            </div>
            <div id="cList" style="margin-top:30px;"></div>
        </div>
    </div>

    <div id="authModal" class="modal" style="justify-content:center; align-items:center; background:rgba(0,0,0,0.95);">
        <div style="width:90%; max-width:400px; background:#050505; padding:50px; border-radius:30px; border:1px solid var(--border); text-align:center; box-shadow:0 0 50px rgba(255,60,0,0.1);">
            <h2 style="color:var(--brand); margin-bottom:10px;">NEXUS ACCESS</h2>
            <p style="opacity:0.5; font-size:12px; margin-bottom:30px;">HNFAK Bulut Sistemine BaÄŸlan</p>
            <div id="authStep1">
                <input type="text" id="uName" placeholder="KullanÄ±cÄ± AdÄ±" style="width:100%; padding:15px; margin-bottom:12px; background:#111; border:1px solid #222; color:#fff; border-radius:12px;">
                <input type="email" id="uMail" placeholder="E-posta" style="width:100%; padding:15px; margin-bottom:25px; background:#111; border:1px solid #222; color:#fff; border-radius:12px;">
                <button onclick="app.sendVerifyCode()" id="sendBtn" class="btn-v33" style="width:100%; justify-content:center;">DOÄžRULAMA KODU AL</button>
                <p onclick="app.guestLogin()" style="margin-top:25px; font-size:13px; opacity:0.4; cursor:pointer;">Misafir Modu</p>
            </div>
            <div id="authStep2" class="hidden">
                <input type="text" id="vCodeInp" placeholder="----" style="width:100%; padding:15px; text-align:center; font-size:40px; background:transparent; border:none; color:var(--brand); letter-spacing:10px;">
                <button onclick="app.verifyAndLogin()" class="btn-v33" style="width:100%; justify-content:center;">SÄ°STEME GÄ°RÄ°Åž YAP</button>
            </div>
        </div>
    </div>

    <script>
        const TMDB_KEY = 'c4c468367090c8c779814353144fe7f7', IMG = 'https://image.tmdb.org/t/p/w500', BG = 'https://image.tmdb.org/t/p/original';
        emailjs.init("xzqFieS_v8a0G8B5B");

        let page = 1, mode = 'trend', currentCatId = null, generatedCode = "", eggCount = 0;
        let favorites = JSON.parse(localStorage.getItem('hn_favs')) || [];
        let cur = {id:'', type:'', s:1, e:1};

        const app = {
            start() {
                this.fetchTrend(); this.checkUser();
                window.onscroll = () => { if((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 800) this.loadMore(); };
            },

            checkUser() {
                const u = localStorage.getItem('hn_u');
                if(u) document.querySelector('.nav-item:last-child span').innerText = u;
            },

            async fetchTrend() {
                const r = await fetch(`https://api.themoviedb.org/3/trending/all/day?api_key=${TMDB_KEY}&language=tr-TR&page=${page}`);
                const d = await r.json(); this.render(d.results, "HaftanÄ±n Parlayan YÄ±ldÄ±zlarÄ±");
            },

            async fetchCat(id, name) {
                mode = 'cat'; currentCatId = id; page = 1; document.getElementById('grid').innerHTML = '';
                const r = await fetch(`https://api.themoviedb.org/3/discover/movie?api_key=${TMDB_KEY}&with_genres=${id}&language=tr-TR&page=${page}`);
                const d = await r.json(); this.render(d.results, name);
                document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                event.target.classList.add('active');
            },

            async searchAI() {
                const q = document.getElementById('aiInp').value;
                if(!q) return;
                mode = 'search'; document.getElementById('grid').innerHTML = '';
                const r = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${TMDB_KEY}&query=${q}&language=tr-TR`);
                const d = await r.json(); this.render(d.results, `AI SonuÃ§larÄ±: ${q}`);
            },

            render(list, t) {
                document.getElementById('section-title').innerText = t;
                list.filter(m => m.poster_path).forEach(m => {
                    const d = document.createElement('div');
                    d.className = 'card';
                    d.innerHTML = `<img src="${IMG}${m.poster_path}" loading="lazy" onclick="app.open('${m.id}','${m.title?'movie':'tv'}','${m.backdrop_path}')">
                                   <div class="card-info">${m.title || m.name}</div>`;
                    document.getElementById('grid').appendChild(d);
                });
            },

            async open(id, type, bp) {
                cur = {id, type, s:1, e:1};
                document.getElementById('pAmbient').style.backgroundImage = `url(${IMG}${bp})`;
                const r = await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${TMDB_KEY}&language=tr-TR`);
                const d = await r.json();
                
                document.getElementById('mT').innerText = d.title || d.name;
                document.getElementById('mD').innerText = d.overview;
                document.getElementById('mRate').innerText = `â­ ${d.vote_average.toFixed(1)} / 10`;
                
                if(type === 'tv') {
                    document.getElementById('tvPanel').classList.remove('hidden');
                    document.getElementById('selS').innerHTML = d.seasons.map(s => `<option value="${s.season_number}">${s.name}</option>`).join('');
                    this.loadEps(d.seasons[0].episode_count);
                } else document.getElementById('tvPanel').classList.add('hidden');

                this.src(1); this.loadComments(id);
                document.getElementById('pModal').style.display = 'flex';
                document.body.style.overflow = 'hidden';
            },

            src(s) {
                const hosts = ['', 'https://vidsrc.me/embed/', 'https://vidsrc.xyz/embed/'];
                document.getElementById('vFrame').src = `${hosts[s]}${cur.type}?tmdb=${cur.id}${cur.type==='tv'?'&season='+cur.s+'&episode='+cur.e:''}`;
            },

            async postComment() {
                const u = localStorage.getItem('hn_u') || "Anonim", t = document.getElementById('cInp').value;
                if(!t) return;
                const cms = JSON.parse(localStorage.getItem('c_'+cur.id)) || [];
                cms.unshift({u, t, d: new Date().toLocaleTimeString()});
                localStorage.setItem('c_'+cur.id, JSON.stringify(cms));
                document.getElementById('cInp').value = ""; this.loadComments(cur.id);
            },

            loadComments(id) {
                const cms = JSON.parse(localStorage.getItem('c_'+id)) || [];
                document.getElementById('cList').innerHTML = cms.map(c => `<div style="background:#080808; padding:15px; border-radius:15px; margin-bottom:12px; border:1px solid #111;"><small style="color:var(--brand)">@${c.u}</small><p style="margin:5px 0; font-size:14px;">${c.t}</p></div>`).join('');
            },

            async sendVerifyCode() {
                const m = document.getElementById('uMail').value, n = document.getElementById('uName').value;
                if(!m || !n) return alert("Eksik bilgi!");
                generatedCode = Math.floor(1000 + Math.random() * 9000).toString();
                emailjs.send("service_5dtv2rj", "template_mkb1ucg", { to_name:n, email:m, passcode:generatedCode, verification_code:generatedCode, company_name:"HNFAK NEXUS" })
                .then(() => { document.getElementById('authStep1').classList.add('hidden'); document.getElementById('authStep2').classList.remove('hidden'); });
            },

            verifyAndLogin() {
                if(document.getElementById('vCodeInp').value === generatedCode) {
                    localStorage.setItem('hn_u', document.getElementById('uName').value);
                    location.reload();
                }
            },

            egg() { eggCount++; if(eggCount === 10) { document.body.style.filter = 'grayscale(1) contrast(2)'; alert("Retro Mod Aktif!"); } },
            loadMore() { if(mode==='trend'||mode==='cat') { page++; mode==='trend'?this.fetchTrend():this.fetchCat(currentCatId, ""); } },
            guestLogin() { localStorage.setItem('hn_u', 'Guest'); location.reload(); },
            authPanel() { document.getElementById('authModal').style.display = 'flex'; },
            close() { document.getElementById('pModal').style.display = 'none'; document.getElementById('vFrame').src=''; document.body.style.overflow='auto'; },
            loadEps(c) { let h = ""; for(let i=1; i<=c; i++) h += `<option value="${i}">${i}. BÃ¶lÃ¼m</option>`; document.getElementById('selE').innerHTML = h; },
            epChange() { cur.s = document.getElementById('selS').value; cur.e = document.getElementById('selE').value; this.src(1); },
            reset(m) { page=1; mode=m; document.getElementById('grid').innerHTML=''; this.fetchTrend(); }
        };

        window.onload = () => app.start();
    </script>
</body>
</html>
